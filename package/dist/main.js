!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){var i,s,n,o,r,h,a={};s=!1,n=0,r=function(t,e){return t+o()*e},h=function(t,e,i){for(var s=0,n=t.length;s<n;s++)t[s]=r(e,i)},(i=a).gaussRandom=o=function(){if(s)return s=!1,n;var t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;if(0==i||i>1)return o();var r=Math.sqrt(-2*Math.log(i)/i);return n=e*r,s=!0,t*r},i.zeros=function(t){if(void 0===t||isNaN(t))return[];if("undefined"==typeof ArrayBuffer){for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e}return new Float64Array(t)},i.assert=function(t,e){if(!t){if(e=e||"Assertion failed","undefined"!=typeof Error)throw new Error(e);throw e}},i.fillRandn=h,i.RandMat=function(t,e,i,s){var n=new Tensor(t,e);return h(n,i,s),n},i.randi=function(t,e){return Math.floor(Math.random()*(e-t)+t)},i.randf=function(t,e){return Math.random()*(e-t)+t},i.randn=r,t.exports=a},function(t,e,i){const s=i(2);window.autograd=s},function(t,e,i){const s=i(0),n=i(3),o=i(4);var r={};!function(t){function e(t){"name"in t?t.name+=s.randi(1,6):t.func_name+=s.randi(1,6)}function i(t,e){this.item=t,this.require_grad=e,this.gradv=0,this.name="<Scalar>"}function r(t,i){this.x=t,this.y=i,e(t),e(i),this.require_grad=!0,this.item=t.item+i.item,this.gradv=0,this.func_name="<scalar_Add>"}function h(t,i){this.item=t.item*i.item,this.x=t,this.y=i,e(t),e(i),this.gradv=0,this.require_grad=!0,this.func_name="<scalar_Multi>"}i.prototype={grad:function(t){this.gradv=t}},r.prototype={backward:function(){this.x.require_grad&&(console.log(this.x instanceof u,this.x.item),this.x.grad(1*this.gradv),"backward"in this.x&&this.x.backward()),this.y.require_grad&&(this.y.grad(1*this.gradv),"backward"in this.y&&this.y.backward())},grad:function(t){this.gradv=t}},h.prototype={backward:function(){this.x.require_grad&&(this.x.grad(this.y.item*this.gradv),"backward"in this.x&&this.x.backward()),this.y.require_grad&&(this.y.grad(this.x.item*this.gradv),"backward"in this.y&&this.y.backward())},grad:function(t){this.gradv=t}};let a=function(t,e){this.n=t,this.d=e,this.out=s.zeros(t*e),this.dout=s.zeros(t*e)},u=function(t,e,i){this.n=t,this.d=e,this.out=s.zeros(t*e),this.dout=s.zeros(t*e),this.require_grad=i,this.name=null};function d(t,e){s.assert(t.out.length===e.out.length),this.items=new a(1,t.out.length);for(let i=0;i<t.out.length;i++)this.items.out[i]=t.out[i]+e.out[i];this.x=t,this.y=e,this.require_grad=!0,this.out=this.items.out,this.dout=this.items.dout,this.n=this.items.n,this.d=this.items.d,this.func_name="<add>"}function l(t,e){s.assert(t.d===e.n,"matmul dimension misaligned"),this.n=t.n,this.d=e.d,this.x=t,this.y=e,this.require_grad=!0,this.items=new a(this.n,this.d),this.out=this.items.out,this.dout=this.items.dout,this.func_name="<Multiply>";for(let s=0;s<t.n;s++)for(let o=0;o<e.d;o++){for(var i=0,n=0;n<t.d;n++)i+=this.x.out[t.d*s+n]*this.y.out[e.d*n+o];this.out[this.d*s+o]=i}}function f(t,e){this.W=new u(t,e,!0).randn(0,.008),this.b=new u(e,1,!0).randn(0,.008),this.func_name="<Linear>",this.require_grad=!0}function c(){this.require_grad=!0,this.func_name="<ReLu>"}function m(){this.func_name="<Softmax>"}function g(t){this.models=t,this.weights=[];let e=0;for(let t=0;t<this.models.length;t++)this.models[t].func_name=`${this.models[t].func_name}_${t}`,this.models[t].hasOwnProperty("W")&&this.models[t].hasOwnProperty("b")&&(this.models[t].W.name="weight_"+e,this.models[t].b.name="bias_"+e,this.weights.push(this.models[t].W.name),this.weights.push(this.models[t].b.name),e+=1)}function p(t,e){this.model=e.out,this.out=-Math.log(e.out.out[t]),this.y=t}function w(t,e){this.model=t,this.lr=e}function y(t={}){let e=t.text,i=t.stopwords;this.embed_dim=t.embed_dim||50;let s=t.window||5,n=e.toLocaleLowerCase().split("\n");if(!i){}let[r,h]=o.gen_word(s,n,i);this.vocab=o.unique_word(h),this.n_words=o.obj_len(this.vocab);let[a,u]=o.create_data(r,this.vocab,this.n_words);this.data=a,this.label=u}u.prototype={get:function(t,e){var i=this.d*t+e;return s.assert(i>=0&&i<this.out.length),this.out[i]},set:function(t,e,i){var n=this.d*t+e;s.assert(n>=0&&n<this.out.length),this.out[n]=i},setFrom:function(t){if(Array.isArray(t[0])){let e=t.length,i=t[0].length;s.assert(e*i==this.n*this.d,"shape not compatible");let n=[];for(let e=0;e<t.length;e++){let i=t[e];n.push(...i)}this.out=n,this.out_tensor=t}else{s.assert(t.length==this.n*this.d,"shape not compatible");for(var e=0,i=t.length;e<i;e++)this.out[e]=t[e]}},randn:function(t,e){return s.fillRandn(this.out,t,e),this},grad:function(t){this.dout=t}},d.prototype={backward:function(){this.x.require_grad&&(this.x.grad(this.dout),"backward"in this.x&&this.x.backward()),this.y.require_grad&&(this.y.grad(this.dout),"backward"in this.y&&this.y.backward())},grad:function(t){s.assert(this.items.dout.length===t.length),this.dout=t}},l.prototype={backward:function(){if(this.x.require_grad){for(let t=0;t<this.x.n;t++)for(let e=0;e<this.y.d;e++)for(let i=0;i<this.x.d;i++){let s=this.dout[this.y.d*t+e];this.x.dout[this.x.d*t+i]+=this.y.out[this.y.d*i+e]*s}"backward"in this.x&&this.x.backward()}if(this.y.require_grad){for(let t=0;t<this.x.n;t++)for(let e=0;e<this.y.d;e++)for(let i=0;i<this.x.d;i++){let s=this.dout[this.y.d*t+e];this.y.dout[this.y.d*i+e]+=this.x.out[this.x.d*t+i]*s}"backward"in this.y&&this.y.backward()}},grad:function(t){s.assert(this.dout.length===t.length),this.dout=t}},f.prototype={forward:function(t){return this.mult=new l(t,this.W),this.items=new d(this.mult,this.b),this.n=this.mult.n,this.d=this.mult.d,this.out=this.items.out,this.dout=this.items.dout,this},backward:function(){this.items.grad(this.dout),this.items.backward()},grad:function(t){s.assert(this.dout.length===t.length),this.dout=t},update:function(t){for(var e=0;e<this.W.out.length;e++)this.W.out[e]-=t*this.W.dout[e];for(e=0;e<this.b.out.length;e++)this.b.out[e]-=t*this.b.dout[e]},get_weight:function(){let t=this.W.n,e=this.W.d,i=Array(t);for(let s=0;s<t;s++){i[s]=[];for(let t=0;t<e;t++){let n=this.W.out.length*t/e+s;i[s].push(this.W.out[n])}}return i}},c.prototype={forward:function(t){this.items=new a(t.n,t.d),this.x=t,this.n=t.n,this.d=t.d;for(var e=0;e<t.out.length;e++)this.items.out[e]=Math.max(0,t.out[e]);return this.out=this.items.out,this.dout=this.items.dout,this},backward:function(){for(var t=0;t<this.x.out.length;t++)this.x.dout[t]=this.x.out[t]>0?this.dout[t]:0;this.x.backward()},grad:function(t){s.assert(this.dout.length===t.length),this.dout=t}},m.prototype={forward:function(t){this.items=new a(1,t.d),this.x=t;for(var e=t.out,i=t.out[0],n=1;n<this.x.d;n++)e[n]>i&&(i=e[n]);var o=s.zeros(this.x.d),r=0;for(n=0;n<this.x.d;n++){var h=Math.exp(e[n]-i);r+=h,o[n]=h}for(n=0;n<this.x.d;n++)o[n]/=r,this.items.out[n]=o[n];return this.out=o,this},backward:function(t){for(var e=this.x,i=0;i<this.items.d;i++){var s=-((i===t?1:0)-this.out[i]);e.dout[i]=s}this.x.grad(e.dout),this.x.backward()}},g.prototype={forward:function(t){this.out=this.models[0].forward(t);for(var e=0;e<this.models.length;e++)0!=e&&(this.out=this.models[e].forward(this.out),this.out.hasOwnProperty("mult")&&this.out.hasOwnProperty("items")&&(this.out.mult.func_name=`${this.out.mult.func_name}_${e}`,this.out.items.func_name=`${this.out.items.func_name}_${e}`))}},p.prototype={backward:function(){this.model.backward(this.y)}},w.prototype={step:function(){for(let t in this.model.models)"update"in this.model.models[t]&&this.model.models[t].update(this.lr)},grad_zero:function(){for(var t in this.model.models)if(Object.prototype.hasOwnProperty.call(this.model.models[t],"W")){let e=this.model.models[t].W.out.length,i=this.model.models[t].b.out.length;this.model.models[t].W.dout=s.zeros(e),this.model.models[t].b.dout=s.zeros(i)}}},y.prototype={train:function(t,e=.01){this.model=new g([new f(this.n_words,this.embed_dim),new f(this.embed_dim,this.n_words),new m]);let i=new w(this.model,e=e);for(let e=0;e<t;e++){let t=0;for(let e=0;e<this.data.length;e++){let s=this.data[e],n=this.label[e],o=new u(1,this.n_words,!1);o.setFrom(s),o.name="input",this.model.forward(o);let r=new p(n-1,this.model);t+=r.out,r.backward(),i.step(),i.grad_zero()}console.log(`for epoch ${e} Loss is ${t/this.data.length}`)}},embed_weight:function(){return this.model.models[0].get_weight()}},t.Scalar=i,t.add=r,t.mult=h,t.Mat=a,t.Tensor=u,t.add=r,t.matmul=l,t.Linear=f,t.ReLU=c,t.Softmax=m,t.Sequential=g,t.Loss=p,t.OptimSGD=w,t.graph=function(t,e=null,i=!1){let s=n(t);if(!i)return s;{let t=anychart.graph(s);t.container(e),t.draw()}},t.Word2Vec=y}(r),t.exports=r},function(t,e){t.exports=function(t){var e={nodes:[],edges:[]};let i=0;return function t(s,n,o){return s.hasOwnProperty("name")&&(console.log("here"),"input"==s.name||s.name.includes("<Scalar>"))?(e.nodes.push({id:""+s.name}),""):(i+=1,e.nodes.push({id:""+s.func_name}),s.hasOwnProperty("x")&&s.hasOwnProperty("y")?(o=s.func_name,e.edges.push({from:""+o,to:""+(s.y.func_name||s.y.name)}),e.nodes.push({id:""+(s.y.func_name||s.y.name)}),e.edges.push({from:""+o,to:""+(s.x.func_name||s.x.name)}),t(s.x,s.x.func_name,o)):s.hasOwnProperty("x")?(o=s.func_name,e.edges.push({from:""+o,to:""+(s.x.func_name||s.x.name)}),t(s.x,s.x.func_name,o)):s.hasOwnProperty("items")?(o=s.func_name,e.edges.push({from:""+o,to:""+(s.items.func_name||s.items.name)}),t(s.items,s.items.func_name,o)):void 0)}(t),e}},function(t,e,i){const s=i(0);var n={};!function(t){function e(t,e){return t.split(" ").filter(t=>""!=t).filter(t=>!e.includes(t)).map(t=>t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,""))}t.gen_word=function(t=5,i,s){let n=[],o=[];for(let r in i){let h=e(i[r],s);o.push(...h);for(let e=0;e<h.length;e++){let i=h[e];for(let s=0;s<t;s++)e+1+s<h.length&&n.push([i,h[e+1+s]]),e-s-1>=0&&n.push([i,h[e-s-1]])}}return[n,o]},t.unique_word=function(t){let e=new Set(t),i=Array.from(e),s={};for(let t=0;t<i.length;t++){s[i[t]]=t+1}return s},t.obj_len=function(t){let e=0;for(let i in t)e+=1;return e},t.create_data=function(t,e,i){let n=[],o=[];for(let r=0;r<t.length;r++){let h=t[r][0],a=t[r][1],u=e[h],d=e[a],l=s.zeros(i);l[u]=1,n.push(l),o.push(d)}return[n,o]}}(n),t.exports=n}]);